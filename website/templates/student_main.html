{% load static %}
<!DOCTYPE html>
<html lang="ro">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Student Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static '/css/student_main.css' %}">
</head>

<body>


    <div class="mobile-overlay" id="mobileOverlay"></div>


    {% include 'sidebar.html' %}

    <div class="main-content" id="mainContent">

        {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
            <div class="alert 
                {% if message.tags == 'error' %} alert-danger 
                {% elif message.tags == 'success' %} alert-success 
                {% else %} alert-info 
                {% endif %}
                shadow-sm alert-dismissible fade show custom-alert" role="alert">

                {{ message }}

                <button type="button" class="btn-close btn-close-black" data-bs-dismiss="alert"
                    aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <button class="btn d-lg-none" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </button>

                <a class="navbar-brand" href="#">
                    <i class="fas fa-home"></i> Dashboard
                </a>
            </div>
        </nav>

        <div class="container-fluid my-4 px-4">


            <div class="welcome-banner">
                <h2>ðŸ‘‹ Welcome back, {{ student.user.first_name }}!</h2>
                <p>Here's what's happening with your studies today.</p>
                <div class="welcome-time">
                    <div class="time-badge">
                        <i class="far fa-clock"></i> {{ current_time }}
                    </div>
                    <div class="time-badge">
                        <i class="fas fa-map-marker-alt"></i> Classroom {{ student.classroom.name }}
                    </div>
                </div>
            </div>


            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="info-card">
                        <div class="info-card-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <h5>Classes Today</h5>
                        <div class="stat-number">{{ classes_today }}</div>
                        <p>Scheduled for today</p>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="info-card">
                        <div class="info-card-icon">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                        <h5>Upcoming Exams</h5>
                        <div class="stat-number">{{ upcoming_exams_count }}</div>
                        <p>In the next 7 days</p>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="info-card">
                        <div class="info-card-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <h5>Your Rank</h5>
                        <div class="stat-number">#{{ student_rank }}</div>
                        <p>Out of {{ total_students }} students</p>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="info-card">
                        <div class="info-card-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h5>Best Subject</h5>
                        <div class="stat-number">{{ best_subject_avg|floatformat:1 }}</div>
                        <p>{{ best_subject_name }}</p>
                    </div>
                </div>
            </div>


            <div class="row">

                <div class="col-lg-8 mb-4">
                    <div class="schedule-card">
                        <h5>
                            <i class="fas fa-calendar-day"></i>
                            Today's Schedule - {{ current_day }}
                        </h5>

                        {% if todays_classes %}
                        {% for class in todays_classes %}
                        <div class="class-item">
                            <div class="class-time">{{ class.start_time|time:"H:i" }}</div>
                            <div class="class-details">
                                <h6>{{ class.subject.name }}</h6>
                                <p><i class="fas fa-user"></i> {{ class.teacher.user.first_name }} {{
                                    class.teacher.user.last_name }}</p>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-calendar-times fa-3x mb-3 d-block opacity-50"></i>
                            <p>No classes scheduled for today!</p>
                        </div>
                        {% endif %}
                    </div>
                </div>


                <div class="col-lg-4 mb-4">
                    <div class="info-card mb-4">
                        <div class="performance-indicator">
                            <div class="performance-circle">{{ average_grade|floatformat:1 }}</div>
                            <div class="performance-label">Overall Average</div>
                            <p class="text-muted mt-2">Keep up the great work!</p>
                        </div>
                    </div>


                    <div class="announcement-card">
                        <h5 style="color: #667eea; margin-bottom: 20px;">
                            <i class="fas fa-bullhorn"></i> Announcements
                        </h5>

                        {% if announcements %}
                        {% for announcement in announcements %}
                        <div class="announcement-item">
                            <h6>{{ announcement.title }}</h6>
                            <p>{{ announcement.message }}</p>
                            <div class="announcement-date">
                                <i class="far fa-calendar"></i> {{ announcement.date|date:"M d, Y" }}
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="text-center text-muted py-3">
                            <i class="fas fa-info-circle fa-2x mb-2 d-block opacity-50"></i>
                            <p>No new announcements</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-12">
                    <div class="schedule-card">
                        <h5>
                            <i class="fas fa-chart-bar"></i>
                            This Week at a Glance
                        </h5>

                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="quick-stat">
                                    <div class="quick-stat-icon"><i class="fas fa-book"></i></div>
                                    <div class="quick-stat-number">{{ classes_this_week }}</div>
                                    <div class="quick-stat-label">Classes This Week</div>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="quick-stat">
                                    <div class="quick-stat-icon"><i class="fas fa-file-alt"></i></div>
                                    <div class="quick-stat-number">{{ exams_this_week }}</div>
                                    <div class="quick-stat-label">Exams This Week</div>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="quick-stat">
                                    <div class="quick-stat-icon"><i class="fas fa-check-circle"></i></div>
                                    <div class="quick-stat-number">{{ attendance_this_week }}%</div>
                                    <div class="quick-stat-label">Attendance Rate</div>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="quick-stat">
                                    <div class="quick-stat-icon"><i class="fas fa-star"></i></div>
                                    <div class="quick-stat-number">{{ grades_this_week }}</div>
                                    <div class="quick-stat-label">New Grades</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>

    </div>


    <script>
        const sidebar = document.getElementById("sidebar");
        const mainContent = document.getElementById("mainContent");
        const mobileToggle = document.getElementById("mobileToggle");
        const mobileOverlay = document.getElementById("mobileOverlay");
        const toggleBtn = document.getElementById("toggleBtn");


        if (toggleBtn) {
            toggleBtn.addEventListener("click", () => {
                sidebar.classList.toggle("collapsed");
                mainContent.classList.toggle("expanded");
            });
        }


        mobileToggle.addEventListener("click", () => {
            sidebar.classList.add("mobile-open");
            mobileOverlay.classList.add("show");
        });


        mobileOverlay.addEventListener("click", () => {
            sidebar.classList.remove("mobile-open");
            mobileOverlay.classList.remove("show");
        });
    </script>

</body>

</html>